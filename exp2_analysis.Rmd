---
title: "Asymmetric alignment paper, Experiment 2 analysis and graphs"
author: "Kenny Smith"
output: html_document
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = TRUE, warning=FALSE)

library(ggplot2)


my.colours <- c("#EA7D00","#006DE9","#808080")

set.seed(67601)

```

# Read in data and report Ns

```{r}
exp2.data <- read.csv("ProcessedData/Experiment2Data.csv")

#put Block in desired order
exp2.data$Block <- factor(exp2.data$Block,
                               levels=c("Training",
                                        "Recall 1",
                                        "Interaction Block 1",
                                        "Interaction Block 2",
                                        "Recall 2"))

#Required to avoid overlapping text in some plots
exp2.data$BlockNewlines <- plyr::revalue(exp2.data$Block,
                                   c("Interaction Block 1"="Interaction\nBlock 1",
                                      "Interaction Block 2"="Interaction\nBlock 2"))

#I want Pair as a factor
#Note: pairs 60-102 collected at Edinburgh, 151-190 collected at Warwick
exp2.data$Pair <- as.factor(exp2.data$Pair)

plyr::ddply(exp2.data,~Condition,plyr::summarise,Current_N=length(unique(Pair)))
```


# Brief report of communicative success

This is high throughout.

```{r}
exp2.by.pair.scores <- aggregate(Score~Condition+Block+Pair,data=subset(exp2.data,Block %in% c("Interaction Block 1", "Interaction Block 2")),FUN=sum)

aggregate(Score~Condition,data=exp2.by.pair.scores,FUN=mean)
aggregate(Score~Block+Condition,data=exp2.by.pair.scores,FUN=mean)
```


# Calculate and plot proportion of marked singulars by block

## Calculate proportions 

```{r}
#We only want to analyse singulars
exp2.data.singulars <- subset(exp2.data,Number==1)
exp2.data.by.block <- aggregate(data=exp2.data.singulars,
                                       Marked~Condition + Pair + Block + BlockNewlines + Participant + ParticipantID,
                                       FUN=mean)

exp2.data.by.block <- plyr::rename(exp2.data.by.block,c("Marked"="ProportionMarkedSingulars"))

#I want it as 100-66 then 100-33 for plots etc
exp2.data.by.block$Condition <- factor(exp2.data.by.block$Condition,levels=c("100-66","100-33"))

exp2.data.by.block$Condition <- plyr::revalue(exp2.data.by.block$Condition,
                                                 c("100-66"="Condition: 100-66",
                                                   "100-33"="Condition: 100-33"))

```

## Proportion plots

One graph for all raw data, another with one facet per pair, one with mean and 95% CIs.

```{r, fig.width=10}
#All data

ggplot(data=exp2.data.by.block, aes(x=BlockNewlines, y=ProportionMarkedSingulars, group=ParticipantID, colour=Pair,ymin=0,ymax=1)) +
  theme_bw() + 
  facet_wrap(~Condition, ncol=4) +
  geom_line() +
  ylab("Proportion Marked Singulars") + 
  theme(axis.title.x = element_blank()) +
  theme(legend.position="none") + 
  scale_y_continuous(breaks=seq(0,1,1/3),labels=c("0","1/3","2/3","1"))
```

```{r, include=FALSE}
#All data, for paper

ggplot(data=exp2.data.by.block, aes(x=BlockNewlines, y=ProportionMarkedSingulars, group=ParticipantID, colour=Pair,ymin=0,ymax=1)) +
  theme_bw() + 
  facet_wrap(~Condition, ncol=4) +
  geom_line() +
  ylab("Proportion Marked Singulars") + 
  theme(axis.title.x = element_blank()) +
  theme(axis.title.y  = element_text(size=12)) +
  theme(axis.text.y  = element_text(size=10)) +
  theme(axis.text.x  = element_text(size=10)) +
  theme(strip.text.x = element_text(size=10))+
  theme(legend.position="none") + 
  scale_y_continuous(breaks=seq(0,1,1/3),labels=c("0","1/3","2/3","1")) +
  ggsave(file="Plots/Exp2NumMarkingByParticipant.pdf",width=8, height=3)
```

```{r}
#For the by-pair plot, need to add a DummyPair column so that the facets work out nicely - this is a little clumsy, but simplest way to do this seems to be to split by condition and convert Pair factor to integers
exp2.data.by.block.10066 <- subset(exp2.data.by.block,Condition=='Condition: 100-66')

exp2.data.by.block.10066$DummyPair <- droplevels(exp2.data.by.block.10066$Pair)

#change levels to integers
levels(exp2.data.by.block.10066$DummyPair) <- 1:length(levels(exp2.data.by.block.10066$DummyPair))

#ditto for other condition
exp2.data.by.block.10033 <- subset(exp2.data.by.block,Condition=='Condition: 100-33')

exp2.data.by.block.10033$DummyPair <- droplevels(exp2.data.by.block.10033$Pair)

#change levels to integers
levels(exp2.data.by.block.10033$DummyPair) <- 1:length(levels(exp2.data.by.block.10033$DummyPair))

#and recombine
exp2.data.by.block.dummyp <- rbind(exp2.data.by.block.10066,exp2.data.by.block.10033)
```

```{r fig.height=20, fig.width=12}
#By-pair plot
ggplot(data=exp2.data.by.block.dummyp, aes(x=BlockNewlines, y=ProportionMarkedSingulars, group=ParticipantID, colour=Pair,ymin=0,ymax=1)) +
  theme_bw() + 
  facet_grid(DummyPair ~ Condition) +
  geom_line() +
  ylab("Proportion Marked Singulars") + 
  theme(legend.position="none") + 
  scale_y_continuous(breaks=seq(0,1,1/3),labels=c("0","1/3","2/3","1")) +
  theme(strip.text.y = element_blank()) + 
  theme(axis.title.x = element_blank()) 
```

```{r include=FALSE}
#By-pair plot, for paper
ggplot(data=exp2.data.by.block.dummyp, aes(x=BlockNewlines, y=ProportionMarkedSingulars, group=ParticipantID, colour=Pair,ymin=0,ymax=1)) +
  theme_bw() + 
  facet_grid(DummyPair ~ Condition) +
  geom_line() +
  ylab("Proportion Marked Singulars") + 
  theme(legend.position="none") + 
  scale_y_continuous(breaks=seq(0,1,1/3),labels=c("0","1/3","2/3","1")) +
  theme(strip.text.y = element_blank()) + 
  theme(axis.title.x = element_blank()) +
  ggsave(file="Plots/Exp2NumMarkingByPair.pdf",width=8, height=10)
```

```{r}
#Means and CIs

ggplot(data=exp2.data.by.block, aes(x=Participant, y=ProportionMarkedSingulars, group=Participant, shape=Participant,fill=Participant)) +
  theme_bw() + 
  facet_grid(Condition~Block) +
  stat_summary(geom='bar', fun.y='mean', position='dodge',colour='black') +
  stat_summary(geom='errorbar',fun.data='mean_cl_boot',fun.ymin="min", fun.ymax="max",colour="black",width=0.1) +
  stat_summary(geom='point', fun.y='mean', position='dodge',colour='black') +
  scale_fill_manual(values=c(my.colours[2],my.colours[1],my.colours[3])) +
  coord_cartesian(ylim=c(0,1)) +
  scale_y_continuous(breaks=seq(0,1,1/3),labels=c("0","1/3","2/3","1")) +
  ylab("Proportion Marked Singulars") + 
  theme(axis.title.x = element_blank()) +
  theme(legend.position="none") 
```

```{r include=FALSE}
#Means and CIs, for paper

ggplot(data=exp2.data.by.block, aes(x=Participant, y=ProportionMarkedSingulars, group=Participant, shape=Participant,fill=Participant)) +
  theme_bw() + 
  facet_grid(Condition~Block) +
  stat_summary(geom='bar', fun.y='mean', position='dodge',colour='black') +
  stat_summary(geom='errorbar',fun.data='mean_cl_boot',fun.ymin="min", fun.ymax="max",colour="black",width=0.1) +
  stat_summary(geom='point', fun.y='mean', position='dodge',colour='black') +
  scale_fill_manual(values=c(my.colours[2],my.colours[1],my.colours[3])) +
  coord_cartesian(ylim=c(0,1)) +
  scale_y_continuous(breaks=seq(0,1,1/3),labels=c("0","1/3","2/3","1")) +
  ylab("Proportion Marked Singulars") + 
  theme(axis.title.x = element_blank()) +
  theme(axis.title.y  = element_text(size=13)) +
  theme(axis.text.y  = element_text(size=11)) +
  theme(axis.text.x  = element_text(size=11)) +
  theme(strip.text.x = element_text(size=11))+
  theme(strip.text.y = element_text(size=11))+
  theme(legend.position="none") + 
  ggsave(file="Plots/Exp2NumMarking.pdf",width=8, height=4)
```


# Plot change from block to block, run statistics on those changes

```{r}
#The most convenient way to calculate differences from block to block is to restructure the data to wide format.
#BlockNewlines causes irritation here, so selecting it out
exp2.change.data <- tidyr::spread(data=dplyr::select(exp2.data.by.block,-BlockNewlines),
                                  Block,ProportionMarkedSingulars)

exp2.change.data$ChangeTrainingRecall1 <- exp2.change.data$'Recall 1' - exp2.change.data$'Training'

exp2.change.data$ChangeRecall1Interaction2 <- exp2.change.data$'Interaction Block 2'-exp2.change.data$'Recall 1'

exp2.change.data$ChangeRecall1Recall2 <- exp2.change.data$'Recall 2'-exp2.change.data$'Recall 1'


#convert back to long format for plotting
exp2.change.data.for.plotting <- dplyr::select(exp2.change.data,-Training,-'Recall 1',-'Recall 2',-'Interaction Block 1',-'Interaction Block 2')

exp2.change.data.for.plotting <- tidyr::gather(exp2.change.data.for.plotting,
BlockToBlock,Change,ChangeTrainingRecall1,ChangeRecall1Interaction2,ChangeRecall1Recall2)

#Make column names more user-friendly
exp2.change.data.for.plotting$BlockToBlock <- plyr::revalue(exp2.change.data.for.plotting$BlockToBlock,
                                                   c("ChangeTrainingRecall1"="Training to Recall 1",
                                                     "ChangeRecall1Interaction2"="Recall 1 to Interaction Block 2",
                                                     "ChangeRecall1Recall2"="Recall 1 to Recall 2"))


#I sometimes want to plot Both Ps as well as P1 and P2 - to do this, I am duplicating the data and labelling the duplicate as "Both Ps" in the Participant column
exp2.change.data.for.plotting.Pscombined <- exp2.change.data.for.plotting
exp2.change.data.for.plotting.Pscombined$Participant <- "Both Ps"
exp2.change.data.for.plotting.combined <- rbind(exp2.change.data.for.plotting,exp2.change.data.for.plotting.Pscombined)
#Reorder the levels so that the BothPs data is last
exp2.change.data.for.plotting.combined$Participant <- factor(exp2.change.data.for.plotting.combined$Participant,levels=c("P1","P2","Both Ps"))

# Add a "Both Conditions" column, which involves duplicating the data
exp2.change.data.for.plotting.Cscombined <- exp2.change.data.for.plotting.combined
exp2.change.data.for.plotting.Cscombined$Condition <- "Both Conditions"
exp2.change.data.for.plotting.combined <- rbind(exp2.change.data.for.plotting.combined,exp2.change.data.for.plotting.Cscombined)
#Reorder the levels so that the Both Conditions data is first
exp2.change.data.for.plotting.combined$Condition <- relevel(exp2.change.data.for.plotting.combined$Condition,ref=c("Both Conditions"))

#Reorder the levels ot BlockToBlock so that they reflect experiment order
exp2.change.data.for.plotting.combined$BlockToBlock <- factor(exp2.change.data.for.plotting.combined$BlockToBlock,levels=c("Training to Recall 1","Recall 1 to Interaction Block 2","Recall 1 to Recall 2"))


```

And calculating within-pair difference change in change, to test for interactions.

```{r}
#The most convenient way to calculate differences from block to block is to restructure the data to wide format.
exp2.p1.p2.diffs.data <- tidyr::spread(data=dplyr::select(exp2.change.data.for.plotting,-ParticipantID),Participant,Change)

exp2.p1.p2.diffs.data$P1P2Difference <- exp2.p1.p2.diffs.data$P1 - exp2.p1.p2.diffs.data$P2


```


## Plots and stats for probability matching (change from Training to Recall 1)

Since the categorical participants are all categorical at recall 1 (with the exception of a single participant who dropped a singular marker once), we are only analysing variably-trained participants - the analysis comes out the same if you include the categorical participants.


```{r}
ggplot(data=subset(exp2.change.data.for.plotting.combined,BlockToBlock=="Training to Recall 1" & Participant=="P2"), aes(x=Participant, y=Change)) +
  theme_bw() + 
  facet_grid(.~Condition) +
  geom_boxplot(fill=my.colours[1]) +
  #scale_fill_manual(values=c(my.colours[2],my.colours[1],my.colours[3])) +
  scale_y_continuous(limits = c(-1,1.1),breaks=seq(-1,1,1/3),labels=c("-1","-2/3","-1/3","0","+1/3","+2/3","+1")) +
  ylab("Change") + 
  theme(axis.title.x = element_blank()) +
  theme(legend.position="none") + 
  ggtitle("Training to Recall 1 (P2s only)") 
  
```




### Stats on change from Training to Recall 1

*Q1a*: considering only the variably-trained participants, do the conditions differ in change from Training to Recall 1? [NB. no need to test P1/P2 or condition x P1/P2 interaction here since we are only analysing the variable P2s.]


```{r}
wilcox.test(subset(exp2.change.data,Condition=="Condition: 100-66" & Participant=="P2")$ChangeTrainingRecall1, 
            subset(exp2.change.data,Condition=="Condition: 100-33"& Participant=="P2")$ChangeTrainingRecall1) 
```

**Yes**. This looks like the same thing we got in Exp 1, with people being pulled towards 0% or 100%. 


*Q2a*: does the change from training  for the variably-trained participants differ from 0, collapsing across condition?

```{r}
wilcox.test(subset(exp2.change.data,Participant=="P2")$ChangeTrainingRecall1)
```

**No significant difference** - as a whole this looks like probability matching.

*Q2b*: same analysis separted by condition, since the earlier test suggested a difference.


```{r}
wilcox.test(subset(exp2.change.data,Condition=="Condition: 100-66" & Participant=="P2")$ChangeTrainingRecall1)
wilcox.test(subset(exp2.change.data,Condition=="Condition: 100-33" & Participant=="P2")$ChangeTrainingRecall1) 
```
Answer is **yes** for the 100-66 condition - they change upwards. 

Answer is **yes** for the 100-33 condition - they change downwards.


##Plots and stats for change in use due to interaction (change from Recall 1 to Interaction 2)

### Plots for change from Recall 1 to Interaction 2


```{r}
ggplot(data=subset(exp2.change.data.for.plotting.combined,BlockToBlock=="Recall 1 to Interaction Block 2" & Participant!="Both Ps"), aes(x=Participant, y=Change, fill=Participant)) +
  theme_bw() + 
  facet_grid(.~Condition)+
  geom_boxplot() +
  scale_fill_manual(values=c(my.colours[2],my.colours[1],my.colours[3])) +
  scale_y_continuous(limits = c(-1,1.1),breaks=seq(-1,1,1/3),labels=c("-1","-2/3","-1/3","0","+1/3","+2/3","+1")) +
  ylab("Change") + 
  theme(axis.title.x = element_blank()) +
  theme(legend.position="none") + 
  ggtitle("Recall 1 To Interaction Block 2") 
  
```


### Stats for change in use due to interaction (change from Recall 1 to Interaction 2)


*Q1a*: do the conditions differ in change from recall 1 to interaction 2?  

```{r}
ggplot(data=subset(exp2.change.data.for.plotting.combined,BlockToBlock=="Recall 1 to Interaction Block 2" & Participant=="Both Ps"), aes(x=Participant, y=Change, fill=Participant)) +
  theme_bw() + 
  facet_grid(. ~ Condition) +
  geom_boxplot() +
  scale_fill_manual(values=c(my.colours[3])) +
  scale_y_continuous(limits = c(-1,1.1),breaks=seq(-1,1,1/3),labels=c("-1","-2/3","-1/3","0","+1/3","+2/3","+1")) +
  ylab("Change") + 
  theme(axis.title.x = element_blank()) +
  theme(legend.position="none") + 
  ggtitle("Recall 1 to Interaction Block 2") 
```


```{r}
wilcox.test(subset(exp2.change.data,Condition=="Condition: 100-66")$ChangeRecall1Interaction2, 
            subset(exp2.change.data,Condition=="Condition: 100-33")$ChangeRecall1Interaction2) 
```

**No significant difference** between conditions.

*Q1b*: do the Participants differ? 

```{r}
ggplot(data=subset(exp2.change.data.for.plotting.combined,BlockToBlock=="Recall 1 to Interaction Block 2" & Participant!="Both Ps" & Condition=="Both Conditions"), aes(x=Participant, y=Change, fill=Participant)) +
  theme_bw() + 
  facet_grid(. ~ Condition) +
  geom_boxplot() +
  scale_fill_manual(values=c(my.colours[2],my.colours[1])) +
  scale_y_continuous(limits = c(-1,1.1),breaks=seq(-1,1,1/3),labels=c("-1","-2/3","-1/3","0","+1/3","+2/3","+1")) +
  ylab("Change") + 
  theme(axis.title.x = element_blank()) +
  theme(legend.position="none") + 
  ggtitle("Recall 1 to Interaction Block 2") 
```

```{r}
wilcox.test(subset(exp2.change.data,Participant=="P1")$ChangeRecall1Interaction2, 
            subset(exp2.change.data,Participant=="P2")$ChangeRecall1Interaction2) 
```
**Yes**. 

*Q1c*: does the difference between Ps differ across conditions?

```{r}

ggplot(data=subset(exp2.p1.p2.diffs.data,BlockToBlock=="Recall 1 to Interaction Block 2"), aes(x=Condition, y=P1P2Difference, fill=Condition)) +
  theme_bw() + 
  geom_boxplot() +
  expand_limits(y=1) +
  scale_fill_manual(values=c(my.colours[2],my.colours[1],my.colours[3])) +
  scale_y_continuous(breaks=seq(-1,1,1/3),labels=c("-1","-2/3","-1/3","0","+1/3","+2/3","+1")) +
  ylab("Difference between P1 and P2") + 
  theme(axis.title.x = element_blank()) +
  theme(legend.position="none") + 
  ggtitle("Recall 1 to Interaction Block 2") 
```

```{r}
wilcox.test(subset(exp2.p1.p2.diffs.data,Condition=="Condition: 100-66" & BlockToBlock=="Recall 1 to Interaction Block 2")$P1P2Difference, 
            subset(exp2.p1.p2.diffs.data,Condition=="Condition: 100-33" & BlockToBlock=="Recall 1 to Interaction Block 2")$P1P2Difference)
```
 
 **Yes**.

*Q2a*: Does the change from Recall 1 to Interaction 2 differ from 0? Running this analysis on P1/P2 seperately since P1s were predicted not to change, so the analysis on the overall dataset is somewhat meaningless. 


```{r}
wilcox.test(subset(exp2.change.data,Participant=="P1")$ChangeRecall1Interaction2)
wilcox.test(subset(exp2.change.data,Participant=="P2")$ChangeRecall1Interaction2) 
```

**P1 do show a marginal effect** (i.e. they only marginally change during interaction). 

**P2 show a clear change.** 

*Q3a*: Since Q1c suggests an interaction, need to consider the P1-P2 difference in each condition seperately. Firstly, do P1 and P2 differ in each condition considered seperately?

```{r}
wilcox.test(subset(exp2.change.data,Condition=="Condition: 100-66" & Participant=="P1")$ChangeRecall1Interaction2, 
            subset(exp2.change.data,Condition=="Condition: 100-66" & Participant=="P2")$ChangeRecall1Interaction2) 

wilcox.test(subset(exp2.change.data,Condition=="Condition: 100-33" & Participant=="P1")$ChangeRecall1Interaction2, 
            subset(exp2.change.data,Condition=="Condition: 100-33" & Participant=="P2")$ChangeRecall1Interaction2) 
```

**Yes for both conditions**. 

*Q3b*: And testing P1 and P2 seperately in each condition - do they show an overall change in marker use? 
```{r}
wilcox.test(subset(exp2.change.data,Condition=="Condition: 100-66" & Participant=="P1")$ChangeRecall1Interaction2)
wilcox.test(subset(exp2.change.data,Condition=="Condition: 100-66" & Participant=="P2")$ChangeRecall1Interaction2) 

wilcox.test(subset(exp2.change.data,Condition=="Condition: 100-33" & Participant=="P1")$ChangeRecall1Interaction2)
wilcox.test(subset(exp2.change.data,Condition=="Condition: 100-33" & Participant=="P2")$ChangeRecall1Interaction2) 
```


**100-66 condition: no effect for P1s, significant effect for P2s.**

**100-33 condition: highly marginal/no effect for P1s, significant effect for P2s.**

*Q3c*: How about comparing P1 and P2 across conditions - do P1s in both conditions show a similar (absence of) change, do P2s show a similar increase? 

```{r}
wilcox.test(subset(exp2.change.data,Condition=="Condition: 100-66" & Participant=="P1")$ChangeRecall1Interaction2, 
            subset(exp2.change.data,Condition=="Condition: 100-33" & Participant=="P1")$ChangeRecall1Interaction2) 

wilcox.test(subset(exp2.change.data,Condition=="Condition: 100-66" & Participant=="P2")$ChangeRecall1Interaction2, 
            subset(exp2.change.data,Condition=="Condition: 100-33" & Participant=="P2")$ChangeRecall1Interaction2) 
```
**No significant difference for P1s, significant difference for P2s** - i.e. P2s change more in the 100-33 condition than the 100-66 condition.


## Plots and stats for lasting effect of interaction (change from Recall 1 to Recall 2)

### Plot for change from Recall 1 to Recall 2. 

```{r}
ggplot(data=subset(exp2.change.data.for.plotting.combined,BlockToBlock=="Recall 1 to Recall 2"), aes(x=Participant, y=Change, fill=Participant)) +
  theme_bw() + 
  facet_grid(.~Condition)+
  geom_boxplot() +
  scale_fill_manual(values=c(my.colours[2],my.colours[1],my.colours[3])) +
  scale_y_continuous(limits = c(-1,1.1),breaks=seq(-1,1,1/3),labels=c("-1","-2/3","-1/3","0","+1/3","+2/3","+1")) +
  ylab("Change") + 
  theme(axis.title.x = element_blank()) +
  theme(legend.position="none") + 
  ggtitle("Recall 1 To Recall 2") 


```



### Stats for change from Recall 1 to Recall 2

*Q1a*: do the conditions differ in change from Recall 1 to Recall 2? 

```{r}
ggplot(data=subset(exp2.change.data.for.plotting.combined,BlockToBlock=="Recall 1 to Recall 2" & Participant=="Both Ps"), aes(x=Participant, y=Change, fill=Participant)) +
  theme_bw() + 
  facet_grid(. ~ Condition) +
  geom_boxplot() +
  scale_fill_manual(values=c(my.colours[3])) +
  scale_y_continuous(limits = c(-1,1.1),breaks=seq(-1,1,1/3),labels=c("-1","-2/3","-1/3","0","+1/3","+2/3","+1")) +
  ylab("Change") + 
  theme(axis.title.x = element_blank()) +
  theme(legend.position="none") + 
  ggtitle("Recall 1 to Recall 2") 
```
```{r}
wilcox.test(subset(exp2.change.data,Condition=="Condition: 100-66")$ChangeRecall1Recall2, 
            subset(exp2.change.data,Condition=="Condition: 100-33")$ChangeRecall1Recall2) 
```

**No significant difference**. 

*Q1b*: do the Ps differ? 

```{r}
ggplot(data=subset(exp2.change.data.for.plotting.combined,BlockToBlock=="Recall 1 to Recall 2" & Participant!="Both Ps" & Condition=="Both Conditions"), aes(x=Participant, y=Change, fill=Participant)) +
  theme_bw() + 
  facet_grid(. ~ Condition) +
  geom_boxplot() +
  scale_fill_manual(values=c(my.colours[2],my.colours[1])) +
  scale_y_continuous(limits = c(-1,1.1),breaks=seq(-1,1,1/3),labels=c("-1","-2/3","-1/3","0","+1/3","+2/3","+1")) +
  ylab("Change") + 
  theme(axis.title.x = element_blank()) +
  theme(legend.position="none") + 
  ggtitle("Recall 1 to Recall 2") 
```

```{r}
wilcox.test(subset(exp2.change.data,Participant=="P1")$ChangeRecall1Recall2, 
            subset(exp2.change.data,Participant=="P2")$ChangeRecall1Recall2) 
```
**Yes**

*Q1c*: does the difference between Ps differ across conditions?


```{r}

ggplot(data=subset(exp2.p1.p2.diffs.data,BlockToBlock=="Recall 1 to Recall 2"), aes(x=Condition, y=P1P2Difference, fill=Condition)) +
  theme_bw() + 
  geom_boxplot() +
  expand_limits(y=1) +
  scale_fill_manual(values=c(my.colours[2],my.colours[1],my.colours[3])) +
  scale_y_continuous(breaks=seq(-1,1,1/3),labels=c("-1","-2/3","-1/3","0","+1/3","+2/3","+1")) +
  ylab("Difference between P1 and P2") + 
  theme(axis.title.x = element_blank()) +
  theme(legend.position="none") + 
  ggtitle("Recall 1 to Recall 2") 
```

```{r}
wilcox.test(subset(exp2.p1.p2.diffs.data,Condition=="Condition: 100-66" & BlockToBlock=="Recall 1 to Recall 2")$P1P2Difference, 
            subset(exp2.p1.p2.diffs.data,Condition=="Condition: 100-33" & BlockToBlock=="Recall 1 to Recall 2")$P1P2Difference)
```

**No significant difference**, i.e. no interaction.

*Q2a*: does the change from Recall 1 to Recall 2 differ from 0? 
```{r}
wilcox.test(exp2.change.data$ChangeRecall1Recall2) 
```

**Marginally**. 

*Q2b*: since the participants differed in amount of change (and since they were predicted to be affected differentially by interaction), test them separately - since there was no interaction between condition, we are collapsing across condition. 

```{r}
wilcox.test(subset(exp2.change.data,Participant=='P1')$ChangeRecall1Recall2) 
wilcox.test(subset(exp2.change.data,Participant=='P2')$ChangeRecall1Recall2) 
```

**Effect is n.s. for P1, but significant for P2.** Note that this is in the opposite direction to Exp 1 - In Exp 1 it's the low-freq participants that don't change from recall 1 to recall 2, but in Exp 2 it's the high-freq (i.e. categorical) participants. 


**Additional Q (from a reviewer)**: how about if we only look at people who produce variable output at recall 1? 

Only P2s are variable at Recall1, there are 31 such participants. **This effect is marginal** 

```{r}
variable.recall1.participants <- subset(exp2.data.by.block,Participant=='P2' & Block=='Recall 1' & ProportionMarkedSingulars>0 & ProportionMarkedSingulars<1)$ParticipantID

length(variable.recall1.participants)


wilcox.test(subset(exp2.change.data,ParticipantID %in% variable.recall1.participants)$ChangeRecall1Recall2)
```

## Combined plot showing all three block-to-block changes.

```{r}
ggplot(data=subset(exp2.change.data.for.plotting.combined,BlockToBlock%in% c("Training to Recall 1","Recall 1 to Interaction Block 2","Recall 1 to Recall 2")), aes(x=Participant, y=Change, fill=Participant)) +
  theme_bw() + 
  facet_grid(BlockToBlock~Condition) +
  geom_boxplot() +
  scale_fill_manual(values=c(my.colours[2],my.colours[1],my.colours[3])) +
  scale_y_continuous(limits = c(-1,1.1),breaks=seq(-1,1,1/3),labels=c("-1","-2/3","-1/3","0","+1/3","+2/3","+1")) +
  ylab("Change") + 
  theme(axis.title.x = element_blank()) +
  theme(legend.position="none") 

```

```{r include=FALSE}
#for paper - includes annotations for statistical significance.

#Because of the way ggplot handles annotations on multi-facet plots, need to specify the annotations and lines in dataframes of their own!

###differences between conditions/participants (plotted with horizontal lines)
##annotations for significance - Training to Recall 1
#I am not testing differences between condition at recall 1 since these are trivial
#both conditions combined
condition.annotations.1 <- NULL

#100-66 
condition.annotations.2 <- NULL

#100-33 
condition.annotations.3 <- NULL

##annotations for significance - Recall 1 to Interaction 2
#both conditions combined
condition.annotations.4 <- data.frame(BlockToBlock="Recall 1 to Interaction Block 2",
                                      Condition="Both Conditions",
                                      Participant=NA,
                                      x=1.5, #positions for stars
                                      y=1.1, 
                                      note="***"
                                      )

#100-66
condition.annotations.5 <- data.frame(BlockToBlock="Recall 1 to Interaction Block 2",
                                      Condition="Condition: 100-66",
                                      Participant=NA,
                                      x=1.5, #positions for stars
                                      y=1.1, 
                                      note="*"
                                      )

#100-33
condition.annotations.6 <- data.frame(BlockToBlock="Recall 1 to Interaction Block 2",
                                      Condition="Condition: 100-33",
                                      Participant=NA,
                                      x=1.5, #positions for stars
                                      y=1.1, 
                                      note="**"
                                      )



#annotations for significance - Recall 1 to Recall 2
#both conditions combined
condition.annotations.7 <- data.frame(BlockToBlock="Recall 1 to Recall 2",
                                      Condition="Both Conditions",
                                      Participant=NA,
                                      x=1.5, #positions for stars
                                      y=1.1, 
                                      note="*"
                                      )

#100-66 - no interaction, so no separate comparison by condition
condition.annotations.8 <- NULL 

#100-33 - no interaction, so no separate comparison by condition
condition.annotations.9 <- NULL



condition.annotations <- rbind(condition.annotations.1,
                               condition.annotations.2,
                               condition.annotations.3,
                               condition.annotations.4,
                               condition.annotations.5,
                               condition.annotations.6,
                               condition.annotations.7,
                               condition.annotations.8,
                               condition.annotations.9
                               )

#positions for lines
                                    

condition.annotations.lines.1a <- NULL
condition.annotations.lines.1b <- NULL
condition.annotations.lines.2a <- NULL
condition.annotations.lines.2b <- NULL
condition.annotations.lines.3a <- NULL
condition.annotations.lines.3b <- NULL

condition.annotations.lines.4a <- data.frame(BlockToBlock="Recall 1 to Interaction Block 2",
                                      Condition="Both Conditions",
                                      Participant=NA,
                                      x=1, y=1.1, xend=1.3, yend=1.1)
condition.annotations.lines.4b <- data.frame(BlockToBlock="Recall 1 to Interaction Block 2",
                                      Condition="Both Conditions",
                                      Participant=NA,
                                      x=1.7, y=1.1, xend=2, yend=1.1)

condition.annotations.lines.5a <- data.frame(BlockToBlock="Recall 1 to Interaction Block 2",
                                      Condition="Condition: 100-66",
                                      Participant=NA,
                                      x=1, y=1.1, xend=1.4, yend=1.1)
condition.annotations.lines.5b <- data.frame(BlockToBlock="Recall 1 to Interaction Block 2",
                                      Condition="Condition: 100-66",
                                      Participant=NA,
                                      x=1.6, y=1.1, xend=2, yend=1.1)

condition.annotations.lines.6a <- data.frame(BlockToBlock="Recall 1 to Interaction Block 2",
                                      Condition="Condition: 100-33",
                                      Participant=NA,
                                      x=1, y=1.1, xend=1.4, yend=1.1)
condition.annotations.lines.6b <- data.frame(BlockToBlock="Recall 1 to Interaction Block 2",
                                      Condition="Condition: 100-33",
                                      Participant=NA,
                                      x=1.6, y=1.1, xend=2, yend=1.1)


condition.annotations.lines.7a <- data.frame(BlockToBlock="Recall 1 to Recall 2",
                                      Condition="Both Conditions",
                                      Participant=NA,
                                      x=1, y=1.1, xend=1.4, yend=1.1)
condition.annotations.lines.7b <- data.frame(BlockToBlock="Recall 1 to Recall 2",
                                      Condition="Both Conditions",
                                      Participant=NA,
                                      x=1.6, y=1.1, xend=2, yend=1.1)
condition.annotations.lines.8a <- NULL
condition.annotations.lines.8b <- NULL
condition.annotations.lines.9a <- NULL
condition.annotations.lines.9b <- NULL



condition.annotations.lines <- rbind(condition.annotations.lines.1a,condition.annotations.lines.1b,
                                     condition.annotations.lines.2a,condition.annotations.lines.2b,
                                     condition.annotations.lines.3a,condition.annotations.lines.3b,
                                     condition.annotations.lines.4a,condition.annotations.lines.4b,
                                     condition.annotations.lines.5a,condition.annotations.lines.5b,
                                     condition.annotations.lines.6a,condition.annotations.lines.6b,
                                     condition.annotations.lines.7a,condition.annotations.lines.7b,
                                     condition.annotations.lines.8a,condition.annotations.lines.8b,
                                     condition.annotations.lines.9a,condition.annotations.lines.9b
                                     )


###differences from 0 (no lines)
##annotations for significance - Training to Recall 1

#both combined - not evaluating
baseline.annotations.1 <- #not testing P1s
baseline.annotations.2 <- data.frame(BlockToBlock="Training to Recall 1",
                                      Condition="Both Conditions",
                                      Participant="P2",
                                     x=1.8,y=2.4/6,note="n.s.") 

#100-66
baseline.annotations.3 <- NULL #not testing significance for P1s 
baseline.annotations.4 <- data.frame(BlockToBlock="Training to Recall 1",
                                      Condition="Condition: 100-66",
                                      Participant="P2",
                                     x=2,y=2.4/6,note="*")  

#100-33 
baseline.annotations.5 <- NULL #not testing significance for P1s 
baseline.annotations.6 <- data.frame(BlockToBlock="Training to Recall 1",
                                      Condition="Condition: 100-33",
                                      Participant="P2",
                                     x=1.8,y=0.5/6,note="**") 




##annotations for significance - Recall 1 to Interaction 2
#both conditions combined
baseline.annotations.7 <- data.frame(BlockToBlock="Recall 1 to Interaction Block 2",
                                      Condition="Both Conditions",
                                      Participant="P1",
                                     x=1,y=1.5/6,note="p=.058") #add note about n.s.difference from 0
baseline.annotations.8 <- data.frame(BlockToBlock="Recall 1 to Interaction Block 2",
                                      Condition="Both Conditions",
                                      Participant="P2",
                                     x=1.8,y=4.5/6,note="***")  #add note about n.s.difference from 0


#100-66
baseline.annotations.9 <- data.frame(BlockToBlock="Recall 1 to Interaction Block 2",
                                      Condition="Condition: 100-66",
                                      Participant="P1",
                                     x=1,y=1/6,note="n.s.") 
baseline.annotations.10 <- data.frame(BlockToBlock="Recall 1 to Interaction Block 2",
                                      Condition="Condition: 100-66",
                                      Participant="P2",
                                     x=1.8,y=1.5/6,note="*")  


#100-33
baseline.annotations.11 <- data.frame(BlockToBlock="Recall 1 to Interaction Block 2",
                                      Condition="Condition: 100-33",
                                      Participant="P1",
                                     x=1,y=1/6,note="p=.098") 
baseline.annotations.12 <- data.frame(BlockToBlock="Recall 1 to Interaction Block 2",
                                      Condition="Condition: 100-33",
                                      Participant="P2",
                                     x=1.8,y=5/6,note="**")  #add note about n.s.difference from 0


##annotations for significance - Recall 1 to Recall 2
#both conditions combined
baseline.annotations.13 <- data.frame(BlockToBlock="Recall 1 to Recall 2",
                                      Condition="Both Conditions",
                                      Participant="P1",
                                     x=1,y=1/6,note="n.s.") #add note about n.s.difference from 0
baseline.annotations.14 <- data.frame(BlockToBlock="Recall 1 to Recall 2",
                                      Condition="Both Conditions",
                                      Participant="P2",
                                     x=1.8,y=1.5/6,note="*")  #add note about n.s.difference from 0

#100-66 - no interaction so not testing
baseline.annotations.15 <- NULL
baseline.annotations.16 <- NULL


#100-33 - no interaction so not testing
baseline.annotations.17 <- NULL
baseline.annotations.18 <- NULL



  

baseline.annotations <- rbind(baseline.annotations.1,baseline.annotations.2,baseline.annotations.3,
                              baseline.annotations.4,baseline.annotations.5,baseline.annotations.6,
                              baseline.annotations.7,baseline.annotations.8,baseline.annotations.9,
                              baseline.annotations.10,baseline.annotations.11,baseline.annotations.12,
                              baseline.annotations.13,baseline.annotations.14,baseline.annotations.15,
                              baseline.annotations.16,baseline.annotations.17,baseline.annotations.18)



#filtering out P1s at the training-to-recall point
ggplot(data=subset(exp2.change.data.for.plotting.combined,BlockToBlock%in% c("Training to Recall 1","Recall 1 to Interaction Block 2","Recall 1 to Recall 2") & Participant!="Both Ps" & !(Participant=="P1" & BlockToBlock=="Training to Recall 1")), aes(x=Participant, y=Change, fill=Participant)) +
  theme_bw() + 
  facet_grid(BlockToBlock~Condition) +
  geom_boxplot() +
  scale_fill_manual(values=c(my.colours[2],my.colours[1],my.colours[3])) +
  scale_y_continuous(limits = c(-1,1.1),breaks=seq(-1,1,1/3),labels=c("-1","-2/3","-1/3","0","+1/3","+2/3","+1")) +
  ylab("Change") + 
  theme(axis.title.x = element_blank()) +
  theme(legend.position="none") + 
  
  geom_text(data=condition.annotations,aes(x=x,y=y,label=note)) +
  geom_segment(data=condition.annotations.lines,aes(x=x,y=y,xend=xend,yend=yend)) +
  geom_text(data=baseline.annotations,aes(x=x,y=y,label=note)) +
  
  ggsave(file="Plots/Exp2AllChanges.pdf",width=6, height=8)


```


# Plot within-pair differences and do statistics over these

We can measure alignment using within-pair difference in marker usage - lower within-pair difference is indicative of higher alignment.

## Plots showing within-pair differences

```{r}
# The easiest way to do this is to build a wide-format table by subsetting based on P then merging

p1 <- dplyr::select(subset(exp2.data.by.block,Participant=="P1"),-Participant,-ParticipantID)
p2 <- dplyr::select(subset(exp2.data.by.block,Participant=="P2"),-Participant,-ParticipantID)
exp2.diffs <- merge(p1,p2,by=c('Condition','Pair','Block','BlockNewlines'))

#calculate absolute diffs
exp2.diffs$Difference <- abs(exp2.diffs$ProportionMarkedSingulars.x-exp2.diffs$ProportionMarkedSingulars.y)

#remove unnecessary columns, reorder Block again
exp2.diffs <- dplyr::select(exp2.diffs,-ProportionMarkedSingulars.x,-ProportionMarkedSingulars.y)
```


```{r}
ggplot(data=exp2.diffs, aes(x=BlockNewlines, y=Difference, fill=Condition,ymin=0,ymax=1)) +
  theme_bw() + 
  geom_boxplot() +
  facet_grid(Condition~.) +
  scale_fill_manual(values=c(my.colours[2],my.colours[1],my.colours[3])) +
  scale_y_continuous(breaks=seq(0,1,1/3),labels=c("0","1/3","2/3","1")) +
  ylab("Within-Pair Difference") + 
  theme(axis.title.x = element_blank()) +
  theme(legend.position="none")
```

```{r include=FALSE}
#Plot for paper
ggplot(data=exp2.diffs, aes(x=BlockNewlines, y=Difference, fill=Condition,ymin=0,ymax=1)) +
  theme_bw() + 
  geom_boxplot() +
  facet_grid(Condition~.) +
  scale_fill_manual(values=c(my.colours[2],my.colours[1],my.colours[3])) +
  scale_y_continuous(breaks=seq(0,1,1/3),labels=c("0","1/3","2/3","1")) +
  ylab("Within-Pair Difference") + 
  theme(axis.title.x = element_blank()) +
  theme(legend.position="none") +  
  ggsave(file="Plots/Exp2DiffPlot.pdf",width=5, height=3)
```

## Plots and stats on change in within-pair differences


```{r}
#The most convenient way to calculate differences from block to block is to restructure the data to wide format.
exp2.diffs.change.data <- tidyr::spread(data=dplyr::select(exp2.diffs,-BlockNewlines),
                                        Block,Difference)

exp2.diffs.change.data$ChangeTrainingRecall1 <- exp2.diffs.change.data$'Recall 1' - exp2.diffs.change.data$'Training'

exp2.diffs.change.data$ChangeRecall1Interaction2 <- exp2.diffs.change.data$'Interaction Block 2'-exp2.diffs.change.data$'Recall 1'

exp2.diffs.change.data$ChangeRecall1Recall2 <- exp2.diffs.change.data$'Recall 2'-exp2.diffs.change.data$'Recall 1'


#convert back to long format for plotting
exp2.diffs.change.data.for.plotting <- dplyr::select(exp2.diffs.change.data,-Training,-'Recall 1',-'Recall 2',-'Interaction Block 1',-'Interaction Block 2')

exp2.diffs.change.data.for.plotting <- tidyr::gather(exp2.diffs.change.data.for.plotting,
BlockToBlock,DifferenceChange,ChangeTrainingRecall1,ChangeRecall1Interaction2,ChangeRecall1Recall2)

#Make column names more user-friendly
exp2.diffs.change.data.for.plotting$BlockToBlock <- plyr::revalue(exp2.diffs.change.data.for.plotting$BlockToBlock,
                                                   c("ChangeTrainingRecall1"="Training to Recall 1",
                                                     "ChangeRecall1Interaction2"="Recall 1 to Interaction Block 2",
                                                     "ChangeRecall1Recall2"="Recall 1 to Recall 2"))

#For one plot I want the conditions seperately and combined, achieving this by duplicating the data
exp2.diffs.change.data.for.plotting.combined <- exp2.diffs.change.data.for.plotting
exp2.diffs.change.data.for.plotting.combined$Condition <- "Both\nconditions"
exp2.diffs.change.data.for.plotting.combined <- rbind(exp2.diffs.change.data.for.plotting,exp2.diffs.change.data.for.plotting.combined)

```

## Plots and stats for change in within-pair difference due to interaction (change from Recall 1 to Interaction 2)

### Plots of change in within-pair difference from Recall 1 to Interaction 2

```{r}

ggplot(data=subset(exp2.diffs.change.data.for.plotting.combined,BlockToBlock=="Recall 1 to Interaction Block 2"), aes(x=Condition, y=DifferenceChange, fill=Condition)) +
  theme_bw() + 
  geom_boxplot() +
  expand_limits(y=1) +
  scale_fill_manual(values=c(my.colours[2],my.colours[1],my.colours[3])) +
  scale_y_continuous(breaks=seq(-1,1,1/3),labels=c("-1","-2/3","-1/3","0","+1/3","+2/3","+1")) +
  ylab("Change In Within-Pair Difference") + 
  theme(axis.title.x = element_blank()) +
  theme(legend.position="none") + 
  ggtitle("Recall 1 to Interaction Block 2") 
```


## Stats for change in within-pair difference due to interaction (change from Recall 1 to interaction 2)

Q1: do the conditions differ in change from recall 1 to interaction 2? **Yes**. 

```{r}
wilcox.test(subset(exp2.diffs.change.data,Condition=="Condition: 100-66")$ChangeRecall1Interaction2, 
            subset(exp2.diffs.change.data,Condition=="Condition: 100-33")$ChangeRecall1Interaction2) 
```

Q2a: do the change from recall 1 to interaction 2 differ from 0? **Yes**. 

```{r}
wilcox.test(exp2.diffs.change.data$ChangeRecall1Interaction2) 
```

Q2b: do the same seperately, by condition.

**100-66 shows the effect.** 

**100-33 show the effect.**

```{r}
wilcox.test(subset(exp2.diffs.change.data,grepl("100-66",Condition))$ChangeRecall1Interaction2)
wilcox.test(subset(exp2.diffs.change.data,grepl("100-33",Condition))$ChangeRecall1Interaction2) 
```

## Plots and stats for lasting change in within-pair difference  (change from Recall 1 to Recall 2)

### Plots of change in within-pair difference from Recall 1 to Recall 2

```{r}
ggplot(data=subset(exp2.diffs.change.data.for.plotting.combined,BlockToBlock=="Recall 1 to Recall 2"), aes(x=Condition, y=DifferenceChange, fill=Condition)) +
  theme_bw() + 
  geom_boxplot() +
  expand_limits(y=1) +
  scale_fill_manual(values=c(my.colours[2],my.colours[1],my.colours[3])) +
  scale_y_continuous(breaks=seq(-1,1,1/3),labels=c("-1","-2/3","-1/3","0","+1/3","+2/3","+1")) +
  ylab("Change In Within-Pair Difference") + 
  theme(axis.title.x = element_blank()) +
  #theme(strip.text.y = element_blank()) + 
  theme(legend.position="none",plot.title = element_text(size=12,hjust=0.5)) + 
  ggtitle("Recall 1 to Recall 2")
```


### Stats for change in within-pair difference from Recall 1 to Recall 2

This is another way of measuring lasting alignment.

Q1: do the conditions differ in change in difference from recall 1 to recall 2? **No**.

```{r}
wilcox.test(subset(exp2.diffs.change.data,grepl("100-66",Condition))$ChangeRecall1Recall2, 
            subset(exp2.diffs.change.data,grepl("100-33",Condition))$ChangeRecall1Recall2) 
```

Q2: does the change from recall 1 to recall 2 differ from 0?  **Marginally** 

```{r}
wilcox.test(exp2.diffs.change.data$ChangeRecall1Recall2) 
```
Q3: And the same question separated by condition (as requested by a reviewer). n.s. for 100-66, marginal for 100-33. 
```{r}
wilcox.test(subset(exp2.diffs.change.data, Condition=="Condition: 100-66")$ChangeRecall1Recall2) 
wilcox.test(subset(exp2.diffs.change.data, Condition=="Condition: 100-33")$ChangeRecall1Recall2) 
```

## Additional combined plot showing change in within-pair difference

The most consistent way to show the change in within-pair difference from recall 1 to interaction 2 *and* recall 1 to recall 2 is a combined plot, using facet labels to identify the block.

```{r}

#For this plot I need to use the shortened condition names to avoid problems with font size or the x-axis.
exp2.diffs.change.data.for.plotting.combined$ShortCondition <- plyr::revalue(exp2.diffs.change.data.for.plotting.combined$Condition,
                                                                       c("Condition: 100-66"="100-66",
                                                                         "Condition: 100-33"="100-33"))
ggplot(data=subset(exp2.diffs.change.data.for.plotting.combined,BlockToBlock %in% c("Recall 1 to Interaction Block 2","Recall 1 to Recall 2")), aes(x=ShortCondition, y=DifferenceChange, fill=ShortCondition)) +
  theme_bw() + 
  facet_grid(.~BlockToBlock) +
  geom_boxplot() +
  expand_limits(y=1) +
  scale_fill_manual(values=c(my.colours[2],my.colours[1],my.colours[3])) +
  scale_y_continuous(breaks=seq(-1,1,1/3),labels=c("-1","-2/3","-1/3","0","+1/3","+2/3","+1")) +
  ylab("Change In Within-Pair Difference") + 
  theme(axis.title.x = element_blank()) +
  #theme(strip.text.y = element_blank()) + 
  theme(legend.position="none",plot.title = element_text(size=12,hjust=0.5)) 
```


```{r include=FALSE}
#And the same plot with annotations for the paper

#As above, because the plot is facetted, need to create dataframes with various annotations then add

###differences between conditions (plotted with horizontal lines)
##annotations for significance - Recall 1 to interaction
condition.annotations.1 <- data.frame(BlockToBlock="Recall 1 to Interaction Block 2",
                                      ShortCondition="Both\nConditions",
                                      x=1.5, #positions for stars
                                      y=1.09, 
                                      note="***"
                                      )

##annotations for significance - Recall 1 to recall 2 - this is n.s.
condition.annotations.2 <- NULL



condition.annotations <- rbind(condition.annotations.1,
                               condition.annotations.2
                               )

#positions for lines
                                      
condition.annotations.lines.1a <- data.frame(BlockToBlock="Recall 1 to Interaction Block 2",
                                      ShortCondition="Both\nConditions",
                                      x=1, y=1.1, xend=1.3, yend=1.1)
condition.annotations.lines.1b <- data.frame(BlockToBlock="Recall 1 to Interaction Block 2",
                                      ShortCondition="Both\nConditions",
                                      x=1.7, y=1.1, xend=2, yend=1.1)

condition.annotations.lines <- rbind(condition.annotations.lines.1a,condition.annotations.lines.1b
                                     )


###differences from 0 (no lines)
##annotations for significance - Recall 1 to Interaction 2
#100-66
baseline.annotations.1 <- data.frame(BlockToBlock="Recall 1 to Interaction Block 2",
                                      ShortCondition="100-66",
                                     x=1,y=1.5/6,note="**") 

#100-33
baseline.annotations.2 <- data.frame(BlockToBlock="Recall 1 to Interaction Block 2",
                                      ShortCondition="100-33",
                                     x=2,y=1.5/6,note="***") 

#both conditions combined
baseline.annotations.3 <- data.frame(BlockToBlock="Recall 1 to Interaction Block 2",
                                      ShortCondition="Both\nConditions",
                                     x=3,y=1.5/6,note="***") 

##annotations for significance - Recall 1 to Recall 2
#100-66
baseline.annotations.4 <- data.frame(BlockToBlock="Recall 1 to Recall 2",
                                      ShortCondition="100-66",
                                     x=0.8,y=1/6,note="n.s.") 

#100-33
baseline.annotations.5 <- data.frame(BlockToBlock="Recall 1 to Recall 2",
                                      ShortCondition="100-33",
                                     x=1.8,y=1/6,note="n.s.") 

#both conditions combined
baseline.annotations.6 <- data.frame(BlockToBlock="Recall 1 to Recall 2",
                                      ShortCondition="Both\nConditions",
                                     x=3,y=4/6,note="p=.079") 



baseline.annotations <- rbind(baseline.annotations.1,baseline.annotations.2,baseline.annotations.3,
                              baseline.annotations.4,baseline.annotations.5,baseline.annotations.6)
#removing annotation of n.s. differences from 0, since there are a lot of these and they clutter the plot
baseline.annotations <- subset(baseline.annotations,note!="n.s.")


ggplot(data=subset(exp2.diffs.change.data.for.plotting.combined,BlockToBlock %in% c("Recall 1 to Interaction Block 2","Recall 1 to Recall 2")), aes(x=ShortCondition, y=DifferenceChange, fill=ShortCondition)) +
  theme_bw() + 
  facet_grid(.~BlockToBlock) +
  geom_boxplot() +
  expand_limits(y=1) +
  scale_fill_manual(values=c(my.colours[2],my.colours[1],my.colours[3],"black")) +
  scale_y_continuous(breaks=seq(-1,1,1/3),labels=c("-1","-2/3","-1/3","0","+1/3","+2/3","+1")) +
  ylab("Change In Within-Pair Difference") + 
  theme(axis.title.x = element_blank()) +
  theme(legend.position="none") +
  
  geom_text(data=condition.annotations,aes(x=x,y=y,label=note)) +
  geom_segment(data=condition.annotations.lines,aes(x=x,y=y,xend=xend,yend=yend)) +
  geom_text(data=baseline.annotations,aes(x=x,y=y,label=note)) +
  ggsave(file="Plots/Exp2DiffChangeAll.pdf",width=5, height=3)
```

